
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Browse Care Providers - Crossing Sunsets‚Ñ¢</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        includedLanguages: 'en,es,zh-CN,fr,de,it,pt,ru,ja,ko,ar',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <style>
    /* ---------- 1. CORE LAYOUT & RESETS ---------- */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height:1.6; color:#333; background:#f5f7fa; }
    
    /* ---------- 2. NAVIGATION ---------- */
    nav { background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%); padding:1rem 2rem; box-shadow:0 2px 10px rgba(0,0,0,.1); position:sticky; top:0; z-index:1000; }
    nav .container { max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; }
    .logo-section { display:flex; align-items:center; gap:15px; }
    .logo-section img { width:50px; height:50px; border-radius:10px; }
    .logo-section h1 { color:#fff; font-size:24px; }
    nav ul { list-style:none; display:flex; gap:2rem; }
    nav a { color:#fff; text-decoration:none; font-weight:500; transition:opacity .3s; }
    nav a:hover { opacity:.8; }
    #google_translate_element { position: fixed; top:75px; right:20px; z-index:9999; background:white; padding:5px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); }

    /* ---------- 3. MAIN CONTAINER ---------- */
    .main-content { max-width:1200px; margin:40px auto; padding:0 20px; }
    .page-header { text-align:center; margin-bottom:40px; }
    .page-header h2 { color:#2c3e50; font-size:2.5rem; margin-bottom:10px; }
    .page-header p { color:#7f8c8d; font-size:1.1rem; }

    /* ---------- 4. LIAISON CARD ---------- */
    .contact-liaison-card { max-width: 900px; margin: 2rem auto 3rem auto; padding: 0 1rem; }
    .contact-liaison-inner { background: #ffffff; border-radius: 16px; padding: 2rem; border: 2px solid #00b4d8; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); position: relative; animation: contactGlow 3s ease-in-out infinite; }
    .liaison-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 1.5rem; }
    .liaison-header h3 { font-size: 1.5rem; color: #023e8a; margin: 0; }
    .liaison-icon-box { width: 48px; height: 48px; border-radius: 50%; background: #e0f7fa; display: flex; align-items: center; justify-content: center; }
    .liaison-icon-box img { width: 28px; height: 28px; object-fit: contain; }
    .liaison-grid { display: grid; grid-template-columns: 1fr 1px 1fr; gap: 2rem; align-items: start; }
    .liaison-divider { background-color: #e2e8f0; height: 100%; width: 1px; }
    .liaison-col { display: flex; flex-direction: column; align-items: flex-start; }
    .liaison-role { font-size: 0.75rem; font-weight: 800; color: #00b4d8; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
    .liaison-name { font-size: 1.25rem; font-weight: 700; color: #1e293b; margin-bottom: 0.25rem; }
    .liaison-desc { font-size: 0.9rem; color: #64748b; margin-bottom: 1rem; }
    .liaison-btn { display: flex; align-items: center; gap: 0.75rem; background: #f8fafc; border: 1px solid #cbd5e1; padding: 0.75rem 1.25rem; border-radius: 12px; text-decoration: none; transition: all 0.2s ease; width: 100%; max-width: 280px; }
    .liaison-btn:hover { background: #e0f7fa; border-color: #00b4d8; }
    .btn-icon-circle { width: 32px; height: 32px; background: #00b4d8; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.9rem; }
    .btn-text { font-weight: 700; color: #334155; }
    .liaison-btn:hover .btn-text { color: #0077b6; }
    @keyframes contactGlow { 0% { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); } 50% { box-shadow: 0 0 25px rgba(0, 180, 216, 0.45); } 100% { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); } }

    /* ---------- 5. STATS & FILTERS ---------- */
    .bed-stats-banner { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; margin-bottom:30px; padding:20px; background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08); }
    .stat-item { text-align:center; padding:15px; border-right:1px solid #E0E0E0; }
    .stat-item:last-child { border-right:none; }
    .stat-number { display:block; font-size:32px; font-weight:700; color:#00ACC1; margin-bottom:5px; }
    .stat-label { display:block; font-size:14px; color:#666; text-transform:uppercase; letter-spacing:.5px; }
    
    .filter-section { background:#fff; padding:25px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,.1); margin-bottom:20px; }
    .filter-label { color:#2c3e50; font-weight:600; margin-bottom:15px; display:block; font-size:1.1rem; }
    .filter-buttons { display:flex; gap:10px; flex-wrap:wrap; }
    .filter-btn { padding:10px 20px; border:2px solid #00bcd4; background:#fff; color:#00bcd4; border-radius:25px; cursor:pointer; font-weight:600; transition:all .3s; font-size:14px; }
    .filter-btn:hover { background:#e0f7fa; }
    .filter-btn.active { background:#00bcd4; color:#fff; }

    .search-box { background:#fff; padding:30px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,.1); margin-bottom:40px; }
    .search-box input { width:100%; padding:15px; border:2px solid #e0e0e0; border-radius:10px; font-size:16px; transition:border-color .3s; }
    .search-box input:focus { outline:none; border-color:#00bcd4; }

    /* ---------- 6. PROVIDER CARDS (POLISHED) ---------- */
    .providers-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap:30px; min-height: 200px; }
    .provider-card { background:#fff; border-radius:15px; overflow:hidden; box-shadow:0 5px 20px rgba(0,0,0,.1); transition:transform .3s; position: relative; }
    .provider-card:hover { transform:translateY(-10px); }
    
    /* Header & Logo */
    .provider-header { background:linear-gradient(135deg, #00bcd4 0%, #0097a7 100%); padding:20px; text-align:center; position: relative; }
    .provider-logo { width:80px; height:80px; border-radius:50%; background:#fff; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:2.5rem; line-height:1; overflow:hidden; position: relative; z-index: 2; border: 3px solid #fff; }
    .provider-header h3 { color:#fff; font-size:1.5rem; margin-bottom:5px; position: relative; z-index: 2; text-shadow: 0 1px 3px rgba(0,0,0,0.2); }
    .provider-header .location { color:rgba(255,255,255,.9); font-size:.9rem; position: relative; z-index: 2; }
    
   /* --- Lotus Certified Badge (BIG + 3D Diploma Frame) --- */
.lotus-badge-container{
  position: absolute;
  top: 14px;
  right: 14px;
  z-index: 10;
}

.lotus-badge-frame{
  display: flex;
  align-items: center;
  justify-content: center;

  width: 96px;
  height: 96px;

  padding: 10px;
  border-radius: 18px;

  background: linear-gradient(
    145deg,
    #ffffff,
    #f1f1f1
  );

  border: 2px solid rgba(255, 200, 80, 0.9);

  box-shadow:
    0 18px 36px rgba(0,0,0,.25),
    inset 0 2px 4px rgba(255,255,255,.9);
}


.lotus-badge-img{
  width: 72px;     /* Desktop */
  height: 72px;
  object-fit: contain;

  background: white;
  border-radius: 12px;
  padding: 6px;

  box-shadow:
    0 10px 18px rgba(0,0,0,.18),
    inset 0 1px 0 rgba(255,255,255,.9);
}

/* Mobile */
@media (max-width: 640px){
  .lotus-badge-img{
    width: 48px;
    height: 48px;
    border-radius: 10px;
    padding: 5px;
  }
}

    
}

/* Desktop emphasis */
@media (min-width: 768px) {
  .lotus-badge-img {
    width: 84px;
    height: 84px;
  }
}

    @keyframes floatBadge {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
        100% { transform: translateY(0px); }
    }

    /* Content Body */
    .provider-body { padding:25px; }
    .provider-type-badge { display:inline-block; background:#e0f7fa; color:#00838f; padding:5px 15px; border-radius:15px; font-size:.85rem; font-weight:600; margin-bottom:15px; }
    .provider-description { color:#666; font-size:.95rem; line-height:1.6; margin-bottom:20px; min-height:60px; }
    
    /* Rating & Tally Bar */
    .rating-section { margin-bottom: 15px; }
    .lotus-row { color: #4caf50; font-size: 1.2rem; margin-bottom: 5px; }
    .review-tally-bar { 
        background: #f0f0f0; 
        border-radius: 10px; 
        height: 8px; 
        width: 100%; 
        overflow: hidden; 
        margin-top: 5px; 
    }
    .review-tally-fill { 
        background: linear-gradient(90deg, #00bcd4, #0097a7); 
        height: 100%; 
        border-radius: 10px; 
        transition: width 1s ease-in-out;
    }
    .review-count-text { font-size: 0.8rem; color: #7f8c8d; margin-top: 3px; display: block; }

    /* Info & Actions */
    .provider-info { margin-bottom: 20px; font-size: 0.95rem; color: #555; }
    .provider-info div { margin-bottom: 5px; }
    
    .bed-availability { margin:15px 0; padding:12px 16px; background:#E8F5E9; border-radius:8px; display:flex; align-items:center; font-weight:600; color:#2E7D32; font-size:16px; }
    .bed-availability.low { background:#FFF3E0; color:#E65100; }
    .bed-icon { margin-right:10px; font-size:20px; }

    .provider-actions { display:flex; gap:10px; }
    .btn { flex:1; padding:12px; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:all .3s; text-align:center; text-decoration:none; display:inline-block; }
    .btn-reviews { background:#ff6b35; color:#fff; }
    .btn-reviews:hover { background:#e55a2b; transform:translateY(-2px); box-shadow: 0 4px 10px rgba(255, 107, 53, 0.3); }
    .btn-review { background:transparent; color:#00bcd4; border:2px solid #00bcd4; }
    .btn-review:hover { background:#00bcd4; color:#fff; }

    .no-results { text-align:center; padding:60px 20px; background:#fff; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,.1); }

    /* Footer */
    footer { background:#2c3e50; color:#fff; padding:40px 20px; text-align:center; margin-top:60px; }
    footer .footer-links { display:flex; justify-content:center; gap:2rem; margin-bottom:20px; flex-wrap:wrap; }
    footer a { color:#fff; text-decoration:none; transition:color .3s; }
    footer a:hover { color:#00bcd4; }
    footer .contact-info { margin-top:20px; font-size:.9rem; }
    footer .contact-info a { color:#00bcd4; }

    @media (max-width:768px) { nav ul { flex-direction:column; gap:1rem; } .providers-grid { grid-template-columns:1fr; } .liaison-grid { grid-template-columns: 1fr; gap: 2rem; } .liaison-divider { display: none; } .liaison-col { align-items: center; text-align: center; border-bottom: 1px solid #e2e8f0; padding-bottom: 2rem; } .liaison-col:last-child { border-bottom: none; padding-bottom: 0; } }
  </style>
</head>
<body>
  <div id="google_translate_element"></div>

  <nav>
    <div class="container">
      <div class="logo-section">
        <img src="crossing-sunsets-logo.png" alt="Crossing Sunsets Logo"/>
        <h1>Crossing Sunsets‚Ñ¢</h1>
      </div>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="browse-providers.html">Browse Providers</a></li>
        <li><a href="quick-signup.html">Leave a Review</a></li>
      </ul>
    </div>
  </nav>

  <div class="main-content">
    <div class="page-header">
      <h2>Browse Care Providers</h2>
      <p>Find compassionate hospice, palliative care, skilled nursing, boarding homes, home care agencies and memory care in your area</p>
    </div>

    <section class="contact-liaison-card">
      <div class="contact-liaison-inner">
        <div class="liaison-header">
          <div class="liaison-icon-box"><img src="lotus-logo.png" alt="Lotus Icon"></div>
          <h3>Need help choosing care?</h3>
        </div>
        <div class="liaison-grid">
          <div class="liaison-col">
            <span class="liaison-role">Patient Liaison</span>
            <h4 class="liaison-name">Iris Merino</h4>
            <p class="liaison-desc">Assisting families with care & admissions.</p>
            <a href="tel:3109240340" class="liaison-btn">
              <div class="btn-icon-circle"><i class="fa-solid fa-phone"></i></div>
              <span class="btn-text">(310) 924-0340</span>
            </a>
          </div>
          <div class="liaison-divider"></div>
          <div class="liaison-col">
            <span class="liaison-role">Physician Liaison</span>
            <h4 class="liaison-name">Christine Bottin</h4>
            <p class="liaison-desc">Coordinating with doctors & facilities.</p>
            <a href="tel:5622199922" class="liaison-btn">
              <div class="btn-icon-circle"><i class="fa-solid fa-phone"></i></div>
              <span class="btn-text">(562) 219-9922</span>
            </a>
          </div>
        </div>
      </div>
    </section>

    <div id="bed-stats-banner" class="bed-stats-banner">
      <div class="stat-item">
        <span id="bedsAvailableTotal" class="stat-number">0</span>
        <span class="stat-label">Beds Available</span>
      </div>
      <div class="stat-item">
        <span id="facilitiesCount" class="stat-number">0</span>
        <span class="stat-label">Facilities</span>
      </div>
      <div class="stat-item">
        <span id="bedsTotal" class="stat-number">0</span>
        <span class="stat-label">Total Beds</span>
      </div>
    </div>

   <div class="filter-section">
  <span class="filter-label">üè• Filter by Type of Care:</span>
  <div class="filter-buttons">
    <button class="filter-btn active" onclick="filterProviders('all', this)">All Providers</button>
    <button class="filter-btn" onclick="filterProviders('hospice', this)">‚ùáÔ∏è Hospice</button>
    <button class="filter-btn" onclick="filterProviders('palliative', this)">üíô Palliative Care</button>
    <button class="filter-btn" onclick="filterProviders('skilled-nursing', this)">üè® Skilled Nursing</button>
    <button class="filter-btn" onclick="filterProviders('board-and-care-facilities', this)">üè° Board and Care Facilities</button>
    <button class="filter-btn" onclick="filterProviders('memory-care', this)">üß† Memory Care</button>
    
    <button class="filter-btn" onclick="filterProviders('senior-living', this)">üèôÔ∏è Senior Living</button>
    <button class="filter-btn" onclick="filterProviders('crf/dd-homes', this)">üß© CRF/DD Homes</button>
    <button class="filter-btn" onclick="filterProviders('care-agencies', this)">üë©‚Äç‚öïÔ∏è Care Agencies</button>
    <button class="filter-btn" onclick="filterProviders('assisted-living', this)">ü¶Ø Assisted Living</button>
    <button class="filter-btn" onclick="filterProviders('adult-day-care', this)">‚òÄÔ∏è Adult Day Care</button>
    <button class="filter-btn" onclick="filterProviders('respite-care', this)">üõå Respite Care</button>
  </div>
</div>

    <div class="search-box">
      <input type="text" id="searchInput" placeholder="üîç Search by city, state, or provider name..." onkeyup="searchProviders()"/>
    </div>

    <div class="providers-grid" id="providersGrid">
        <p style="text-align:center; grid-column: 1/-1;">Connecting to secure database...</p>
    </div>
    
    <div id="noResults" class="no-results" style="display:none;">
      <p>No providers found matching your search.</p>
    </div>
  </div>

  <footer>
    <div class="footer-links">
      <a href="index.html">Home</a>
      <a href="browse-providers.html">Browse Providers</a>
      <a href="plans.html">üîí For Healthcare Providers</a>
      <a href="privacy.html">Privacy</a>
      <a href="mailto:support@crossingsunsets.app">üìß Contact Us</a>
    </div>
    <p>&copy; 2025 Crossing Sunsets‚Ñ¢. All rights reserved.</p>
    <div class="contact-info">
      üí¨ Support: <a href="mailto:support@crossingsunsets.app">support@crossingsunsets.app</a>
    </div>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
    // 1. Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyB410YcmXKj09W82ck6tZ2WYhyLdyZWtEQ",
      authDomain: "crossing-sunsets.firebaseapp.com",
      databaseURL: "https://crossing-sunsets-default-rtdb.firebaseio.com",
      projectId: "crossing-sunsets",
      storageBucket: "crossing-sunsets.firebasestorage.app",
      messagingSenderId: "83761464492",
      appId: "1:83761464492:web:9e05d8af5a45fe1ff38b09",
      measurementId: "G-LG8VN0EZB7"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    let currentFilter = 'all';
    const totalsByCategory = {
      all:{facilities:0,available:0,total:0},
      'skilled-nursing':{facilities:0,available:0,total:0},
      hospice:{facilities:0,available:0,total:0},
      palliative:{facilities:0,available:0,total:0},
      'board-and-care-facilities':{facilities:0,available:0,total:0},
      'memory-care':{facilities:0,available:0,total:0}
    };

    function resetTotals(){Object.keys(totalsByCategory).forEach(k=>totalsByCategory[k]={facilities:0,available:0,total:0});}
    
    function bumpTotals(cat,a,t){
      a=Number(a||0); t=Number(t||0);
      totalsByCategory[cat].facilities++; totalsByCategory.all.facilities++;
      if(Number.isFinite(a)){totalsByCategory[cat].available+=a; totalsByCategory.all.available+=a;}
      if(Number.isFinite(t)){totalsByCategory[cat].total+=t; totalsByCategory.all.total+=t;}
    }

    function updateBannerFor(cat){
      const t=totalsByCategory[cat]||totalsByCategory.all;
      document.getElementById('bedsAvailableTotal').textContent=t.available;
      document.getElementById('facilitiesCount').textContent=t.facilities;
      document.getElementById('bedsTotal').textContent=t.total;
    }

    function normalizeCategory(p){
      const raw=(p.providerType || p.careType || p.serviceType || '').toLowerCase();
      if(raw.includes('skilled'))return 'skilled-nursing';
      if(raw.includes('memory'))return 'memory-care';
      if(raw.includes('board'))return 'board-and-care-facilities';
      if(raw.includes('palliative'))return 'palliative';
      return 'hospice';
    }

    function getCategoryIcon(category) {
      const map = { 'hospice':'üïäÔ∏è','skilled-nursing':'üè®','memory-care':'üß†','board-and-care-facilities':'üè°','palliative':'üíô' };
      return map[category] || 'üè•';
    }

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
    // 1. Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyB410YcmXKj09W82ck6tZ2WYhyLdyZWtEQ",
      authDomain: "crossing-sunsets.firebaseapp.com",
      databaseURL: "https://crossing-sunsets-default-rtdb.firebaseio.com",
      projectId: "crossing-sunsets",
      storageBucket: "crossing-sunsets.firebasestorage.app",
      messagingSenderId: "83761464492",
      appId: "1:83761464492:web:9e05d8af5a45fe1ff38b09",
      measurementId: "G-LG8VN0EZB7"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    let currentFilter = 'all';
    const totalsByCategory = {
      all:{facilities:0,available:0,total:0},
      'skilled-nursing':{facilities:0,available:0,total:0},
      hospice:{facilities:0,available:0,total:0},
      palliative:{facilities:0,available:0,total:0},
      'board-and-care-facilities':{facilities:0,available:0,total:0},
      'memory-care':{facilities:0,available:0,total:0}
    };

    function resetTotals(){Object.keys(totalsByCategory).forEach(k=>totalsByCategory[k]={facilities:0,available:0,total:0});}
    
    function bumpTotals(cat,a,t){
      a=Number(a||0); t=Number(t||0);
      totalsByCategory[cat].facilities++; totalsByCategory.all.facilities++;
      if(Number.isFinite(a)){totalsByCategory[cat].available+=a; totalsByCategory.all.available+=a;}
      if(Number.isFinite(t)){totalsByCategory[cat].total+=t; totalsByCategory.all.total+=t;}
    }

    function updateBannerFor(cat){
      const t=totalsByCategory[cat]||totalsByCategory.all;
      document.getElementById('bedsAvailableTotal').textContent=t.available;
      document.getElementById('facilitiesCount').textContent=t.facilities;
      document.getElementById('bedsTotal').textContent=t.total;
    }

    function normalizeCategory(p){
      const raw=(p.providerType || p.careType || p.serviceType || '').toLowerCase();
      if(raw.includes('skilled'))return 'skilled-nursing';
      if(raw.includes('memory'))return 'memory-care';
      if(raw.includes('board'))return 'board-and-care-facilities';
      if(raw.includes('palliative'))return 'palliative';
      return 'hospice';
    }

    function getCategoryIcon(category) {
      const map = { 'hospice':'üïäÔ∏è','skilled-nursing':'üè®','memory-care':'üß†','board-and-care-facilities':'üè°','palliative':'üíô' };
      return map[category] || 'üè•';
    }

    function isUrlLikely(u){ return /^https?:\/\//i.test(u||''); }
    function safeWebsite(u){ if(!u) return ''; return isUrlLikely(u)? u : `https://${u}`; }

    function providerIsAllPeace(name=''){ return /\ballpeace care hospice\b/i.test(name); }

    function computeLogoMarkup(p, category) {
      const isAllPeace = providerIsAllPeace(p.name);
      if (p.logo && /^https?:\/\//i.test(p.logo)) {
        const fallbackChar = isAllPeace ? '‚òòÔ∏è' : getCategoryIcon(category);
        return `<img src="${p.logo}" alt="${p.name||'logo'}" 
                 style="width:64px;height:64px;border-radius:50%;object-fit:cover;" 
                 onerror="this.outerHTML='<span aria-label=\\'logo\\' role=\\'img\\' style=\\'font-size:2.5rem;\\'>${fallbackChar}</span>'" />`;
      }
      if (isAllPeace) return `<span aria-label="logo" role="img" style="color:#4caf50; font-size: 2.5rem;">‚òòÔ∏è</span>`;
      return `<span aria-label="logo" role="img">${getCategoryIcon(category)}</span>`;
    }

    function getCategoryName(category) {
      const names = {
        'hospice':'Hospice Care',
        'skilled-nursing':'Skilled Nursing',
        'memory-care':'Memory Care',
        'board-and-care-facilities':'Board and Care Facilities',
        'palliative':'Palliative Care'
      };
      return names[category] || 'Healthcare Provider';
    }

    function upsertBedChip(card, category, beds) {
      const body = card.querySelector('.provider-body');
      if (!body) return;
      if (category !== 'skilled-nursing' || !beds || !Number.isFinite(beds.total)) {
        const existing = card.querySelector('.bed-availability');
        if (existing) existing.remove();
        return;
      }
      const isLow = (Number(beds.available) || 0) < 10;
      const html = `
        <div class="bed-availability ${isLow ? 'low' : ''}">
          <span class="bed-icon">üõèÔ∏è</span>
          <span>${Number(beds.available || 0)} / ${Number(beds.total || 0)} Beds Available</span>
        </div>
      `;
      const existing = card.querySelector('.bed-availability');
      if (existing) existing.outerHTML = html;
      else body.insertAdjacentHTML('beforeend', html);
    }

    function getBedsFromFields(p) {
      const aSource = (p.available ?? p.availableBeds);
      const oSource = (p.occupied ?? p.occupiedBeds);
      const tSource = (p.total ?? p.totalBeds);
      const a = Number(aSource);
      const o = Number(oSource);
      const t = Number(tSource);
      const any = [a, o, t].some(n => Number.isFinite(n));
      if (!any) return null;
      const clean = n => (Number.isFinite(n) ? n : 0);
      return { available: clean(a), occupied: clean(o), total: clean(t) };
    }

    function createProviderCard(provider, providerId, category, beds) {
      const card = document.createElement('div');
      card.className = 'provider-card';
      card.setAttribute('data-firebase-id', providerId);
      card.setAttribute('data-name', (provider.name || '').toLowerCase());
      card.setAttribute('data-location', provider.location || '');
      card.setAttribute('data-category', category);

      const logoMarkup = computeLogoMarkup(provider, category);
      const website = safeWebsite(provider.website || '');
      const rating = Number(provider.lotusRating) || 0; 
      const reviewCount = Number(provider.reviewCount) || 0;
      
    let lotusIcons = '';
      for(let i=0; i<rating && i<4; i++) { lotusIcons += '‚òòÔ∏è '; }

      let badgeHTML = '';
      if (rating >= 3) {
          badgeHTML = `
            <div style="position: absolute; top: -15px; right: -15px; z-index: 10;">
              <img src="lotus-certified-badge.png" class="lotus-badge-img" alt="Lotus Certified" title="Lotus Certified Provider">
            </div>
          `;
      }

      const fillPercent = Math.min((reviewCount / 50) * 100, 100);

      card.innerHTML = `
        ${badgeHTML} 
        <div class="provider-header">
          <div class="provider-logo">${logoMarkup}</div>
          <h3>${provider.name || 'Provider Name'}</h3>
          <div class="location">üìç ${provider.location || 'Location not specified'}</div>
        </div>
        <div class="provider-body">
          <div class="rating-section">
             <div class="lotus-row" title="Lotus Rating">${lotusIcons}</div>
             <div class="review-tally-bar" title="${reviewCount} Reviews tallied">
                <div class="review-tally-fill" style="width: ${fillPercent}%"></div>
             </div>
             <span class="review-count-text">${reviewCount} Reviews Tally</span>
          </div>
          <span class="provider-type-badge">${getCategoryIcon(category)} ${getCategoryName(category)}</span>
          <div class="provider-description">${provider.description || 'Quality care services.'}</div>
          <div class="provider-info">
            ${provider.contact ? `<div>üë§ <strong>Contact:</strong> ${provider.contact}</div>`:''}
            ${provider.email ? `<div>üìß <strong>Email:</strong> <a href="mailto:${provider.email}" style="color:#00bcd4;">${provider.email}</a></div>`:''}
            ${(provider.website||'') ? `<div>üåê <strong>Website:</strong> <a href="${website}" target="_blank" rel="noopener" style="color:#00bcd4;">${(provider.website||'').replace(/^https?:\/\//,'')}</a></div>`:''}
          </div>
          <div class="provider-actions" style="margin-top:12px;display:flex;gap:10px;">
            <a href="reviews.html?providerId=${encodeURIComponent(providerId)}&name=${encodeURIComponent(provider.name||'')}" class="btn btn-reviews">üìñ Read Reviews</a>
            <a href="quick-signup.html?provider=${encodeURIComponent(providerId)}" class="btn btn-review">‚úçÔ∏è Leave a Review</a>
          </div>
        </div>
      `;

      upsertBedChip(card, category, beds);
      return card;
}
    function filterProviders(category, btnEl){
      currentFilter=category;
      document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
      if(btnEl)btnEl.classList.add('active');
      const cards=document.querySelectorAll('.provider-card');
      let visible=0;
      cards.forEach(c=>{
        const cat=c.getAttribute('data-category');
        if(category==='all'||cat===category){c.style.display='block';visible++;}
        else c.style.display='none';
      });
      document.getElementById('noResults').style.display=(visible===0 && cards.length > 0)?'block':'none';
      updateBannerFor(currentFilter);
    }

    function searchProviders(){
      const term=(document.getElementById('searchInput').value||'').toLowerCase();
      const cards=document.querySelectorAll('.provider-card');
      let visible=0;
      cards.forEach(card=>{
        const name=(card.getAttribute('data-name')||'').toLowerCase();
        const loc=(card.getAttribute('data-location')||'').toLowerCase();
        const cat=card.getAttribute('data-category');
        const matchFilter=(currentFilter==='all'||cat===currentFilter);
        const matchSearch=(name.includes(term)||loc.includes(term));
        if(matchFilter&&matchSearch){card.style.display='block';visible++;}
        else card.style.display='none';
      });
      const noRes = document.getElementById('noResults');
      if(visible===0 && cards.length > 0) noRes.style.display='block';
      else noRes.style.display='none';
    }

    function loadFirestoreProviders() {
      db.collection('providers').onSnapshot((snapshot) => {
        resetTotals();
        const container = document.getElementById('providersGrid');
        if(snapshot.empty) {
          container.innerHTML = '<p style="grid-column:1/-1; text-align:center;">No providers found.</p>';
          return;
        }

        const loadingMsg = container.querySelector('p');
        if(loadingMsg && loadingMsg.innerText.includes('Connecting')) loadingMsg.remove();

        snapshot.forEach((docSnap) => {
          const raw = docSnap.data() || {};
          const providerId = docSnap.id;
          
          // APPROVED FILTER: This counts only verified reviews to sync with the app
          db.collection('reviews')
            .where('provider_id', '==', providerId)
            .where('approved', '==', true)
            .onSnapshot((reviewSnap) => {
              const approvedCount = reviewSnap.size;
              
              const provider = {
                name: raw.businessName || raw.name || 'Unknown Provider',
                location: raw.serviceArea || raw.location || '',
                description: raw.description || '',
                email: raw.email || '',
                website: raw.website || '',
                contact: raw.contactName || raw.contact || '',
                phone: raw.phone || '',
                logo: raw.imageUrl || raw.logo || '',
                lotusRating: raw.lotusRating || 0,
                reviewCount: approvedCount
              };
              
              const category = normalizeCategory(raw);
              const beds = getBedsFromFields(raw);

              let card = document.querySelector(`[data-firebase-id="${providerId}"]`);
              if (!card) {
                card = createProviderCard(provider, providerId, category, beds);
                container.appendChild(card);
              } else {
                const newCard = createProviderCard(provider, providerId, category, beds);
                container.replaceChild(newCard, card);
              }

              if (category === 'skilled-nursing' && beds) bumpTotals(category, beds.available, beds.total);
              else bumpTotals(category, 0, 0);
              
              updateBannerFor(currentFilter);
              searchProviders();
            });
        });
      }, (error) => { console.error(error); });
    }

    firebase.auth().onAuthStateChanged((user) => {
      if (user) { loadFirestoreProviders(); } 
      else { firebase.auth().signInAnonymously(); }
    });
  </script>
</body>
</html>
Hyper Icon
Hyper Icon
