<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Browse Care Providers - Crossing Sunsets‚Ñ¢</title>
  <style>
    /* --- COLOR PALETTE (Matches your App) --- */
    :root { 
      --primary: #00bcd4; /* The specific teal from your screenshots */
      --primary-dark: #00acc1;
      --text-dark: #334155;
      --text-light: #64748b;
      --bg-gray: #f8fafc;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, system-ui, sans-serif; }
    body { background: var(--bg-gray); color: var(--text-dark); padding-bottom: 4rem; }

    /* --- NAVIGATION --- */
    .nav { background: white; padding: 1rem 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 800; color: var(--primary); font-size: 1.5rem; text-decoration: none; }
    .nav-links a { text-decoration: none; color: var(--text-dark); font-weight: 600; margin-left: 1.5rem; transition: color 0.2s; }
    @media(max-width: 600px) { .nav { padding: 1rem; } .nav-links a { font-size: 0.85rem; margin-left: 10px; } }

    /* --- APP-STYLE HEADER & FILTERS --- */
    .app-section { max-width: 1200px; margin: 2rem auto; padding: 0 1.5rem; }
    
    .app-title { font-size: 2rem; font-weight: 800; color: var(--text-dark); margin-bottom: 0.5rem; }
    .app-subtitle { color: var(--text-light); font-size: 1rem; margin-bottom: 1.5rem; max-width: 700px; line-height: 1.5; }
    
    .filter-label { font-weight: 700; font-size: 0.95rem; margin-bottom: 10px; display: block; color: var(--text-dark); }
    
    /* The "Pill" Buttons */
    .filter-row { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 25px; }
    .filter-btn {
      background: white; 
      border: 1.5px solid var(--primary); 
      color: var(--primary);
      padding: 10px 20px; 
      border-radius: 99px; /* Pill Shape */
      font-weight: 700; 
      font-size: 0.9rem;
      cursor: pointer; 
      transition: all 0.2s ease;
      display: flex; align-items: center; gap: 8px;
    }
    .filter-btn:hover { background: #e0f7fa; transform: translateY(-1px); }
    
    /* Active State (Solid Teal) */
    .filter-btn.active {
      background: var(--primary); 
      color: white; 
      box-shadow: 0 4px 12px rgba(0, 188, 212, 0.3);
    }

    /* Search Bar */
    .search-wrapper { position: relative; max-width: 100%; margin-bottom: 2rem; }
    .search-input {
      width: 100%; padding: 16px 20px 16px 50px; border-radius: 12px;
      border: 1px solid #cbd5e1; font-size: 16px; outline: none; transition: border-color 0.2s;
      background: white;
    }
    .search-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0, 188, 212, 0.1); }
    .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-size: 1.2rem; }

    /* --- PROVIDER GRID --- */
    .section-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 1.5rem; color: var(--text-dark); }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem; }

    /* The Provider Card (Teal Header Style) */
    .card { background: white; border-radius: 16px; overflow: hidden; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: transform 0.2s; display: flex; flex-direction: column; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
    
    .card-header { background: var(--primary); padding: 2rem; text-align: center; color: white; position: relative; }
    .avatar { width: 80px; height: 80px; background: white; border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; font-size: 2.2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
    .card-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .card-location { font-size: 0.9rem; opacity: 0.95; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 4px; }
    
    .card-body { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; gap: 1rem; }
    .tag { align-self: flex-start; background: #e0f7fa; color: #006064; padding: 6px 14px; border-radius: 99px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
    .description { font-size: 0.95rem; line-height: 1.6; color: var(--text-light); flex: 1; }
    .contact-info { font-size: 0.9rem; color: var(--text-dark); display: flex; align-items: center; gap: 8px; margin-top: auto; padding-top: 1rem; border-top: 1px solid #f1f5f9; }
    
    .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
    .btn { padding: 0.85rem; border-radius: 10px; font-weight: 700; text-align: center; text-decoration: none; transition: opacity 0.2s; font-size: 0.95rem; }
    .btn-primary { background: #ff5722; color: white; box-shadow: 0 4px 12px rgba(255, 87, 34, 0.25); } 
    .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: white; }
    .btn:hover { opacity: 0.9; transform: translateY(-1px); }
  </style>
</head>
<body>

  <nav class="nav">
    <a href="index.html" class="brand">Crossing Sunsets‚Ñ¢</a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="browse-providers.html" style="color:var(--primary)">Browse Providers</a>
      <a href="lotus-review.html">Leave a Review</a>
    </div>
  </nav>

  <div class="app-section">
    <h1 class="app-title">Browse Providers</h1>
    <p class="app-subtitle">Find compassionate hospice, palliative care, skilled nursing, Board and Care Facilities, and memory care in your area.</p>

    <label class="filter-label">Filter by Type of Care:</label>
    <div class="filter-row">
      <button class="filter-btn active" onclick="applyFilter('all', this)">
        <span>‚úÖ</span> All Providers
      </button>
      <button class="filter-btn" onclick="applyFilter('hospice', this)">
        <span>üè•</span> Hospice
      </button>
      <button class="filter-btn" onclick="applyFilter('skilled', this)">
        <span>ü©∫</span> Skilled Nursing
      </button>
      <button class="filter-btn" onclick="applyFilter('board', this)">
        <span>üè†</span> Board & Care
      </button>
      <button class="filter-btn" onclick="applyFilter('palliative', this)">
        <span>‚ù§Ô∏è</span> Palliative Care
      </button>
      <button class="filter-btn" onclick="applyFilter('memory', this)">
        <span>üß†</span> Memory Care
      </button>
    </div>

    <div class="search-wrapper">
      <span class="search-icon">üîç</span>
      <input type="text" id="searchInput" class="search-input" placeholder="Search by city, state, or provider name..." onkeyup="runSearch()">
    </div>
    
    <h2 class="section-title">Featured Providers</h2>
    
    <div class="grid" id="providersGrid">
      <p style="text-align:center; grid-column:1/-1; padding:3rem; font-size:1.1rem; color:#64748b;">Loading Providers...</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB410YcmXKj09W82ck6tZ2WYhyLdyZWtEQ",
      authDomain: "crossing-sunsets.firebaseapp.com",
      projectId: "crossing-sunsets",
      storageBucket: "crossing-sunsets.firebasestorage.app",
      messagingSenderId: "83761464492",
      appId: "1:83761464492:web:9e05d8af5a45fe1ff38b09"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadProviders() {
      const grid = document.getElementById('providersGrid');
      
      // 1. FETCH ALL PROVIDERS
      const q = query(collection(db, "providers"));
      
      try {
        const snapshot = await getDocs(q);
        grid.innerHTML = ""; 

        if (snapshot.empty) {
          grid.innerHTML = '<p style="text-align:center; grid-column:1/-1;">No providers found.</p>';
          return;
        }

        let count = 0;
        snapshot.forEach(doc => {
          const p = doc.data();
          const id = doc.id;
          
          // --- THE CRITICAL FIX ---
          // Use .toLowerCase() so "Approved" and "approved" BOTH work.
          const status = (p.status || "").toLowerCase().trim();
          
          // Only show approved
          if (status !== 'approved') return;

          count++;

          // --- SMART TYPE DETECTION ---
          // Check BOTH fields (facilityType is old DB, providerType is new DB)
          const rawType = (p.facilityType || p.providerType || "").toLowerCase();
          
          let icon = "üè•"; // Default
          if (rawType.includes("hospice")) icon = "‚òòÔ∏è";
          else if (rawType.includes("nursing") || rawType.includes("skilled")) icon = "üè•";
          else if (rawType.includes("board") || rawType.includes("care") || rawType.includes("rcfe")) icon = "üè†";
          else if (rawType.includes("memory")) icon = "üß†";
          else if (rawType.includes("palliative")) icon = "‚ù§Ô∏è";

          // Formatting the Tag Label
          let label = p.facilityType || p.providerType || "Care Provider";
          label = label.replace(/_/g, " ").replace(/\b\w/g, l => l.toUpperCase());

          // --- RENDER THE CARD ---
          // Added 'data-type' and 'data-search' so filters work instantly
          grid.innerHTML += `
            <div class="card provider-card" 
                 data-type="${rawType}" 
                 data-search="${(p.businessName + ' ' + p.city + ' ' + p.state).toLowerCase()}">
              
              <div class="card-header">
                <div class="avatar">${icon}</div>
                <div class="card-title">${p.businessName || "Provider Name"}</div>
                <div class="card-location">üìç ${p.city || "City"}, ${p.state || "CA"}</div>
              </div>
              
              <div class="card-body">
                <span class="tag">${label}</span>
                <p class="description">${p.bio || p.description || "Dedicated to providing compassionate care for your loved ones."}</p>
                <div class="contact-info">üìß ${p.email || "Contact for info"}</div>
                
                <div class="actions">
                  <a href="profile.html?id=${id}" class="btn btn-primary">üìñ Read Reviews</a>
                  <a href="lotus-review.html?providerId=${id}&name=${encodeURIComponent(p.businessName)}" class="btn btn-outline">‚úçÔ∏è Leave a Review</a>
                </div>
              </div>
            </div>
          `;
        });

        if (count === 0) {
          grid.innerHTML = '<p style="text-align:center; grid-column:1/-1;">No approved providers found yet.</p>';
        }

      } catch (error) {
        console.error("Firebase Error:", error);
        grid.innerHTML = `<p style="color:red; text-align:center;">Error loading providers. Please check your connection.</p>`;
      }
    }

    loadProviders();
  </script>

  <script>
    window.applyFilter = function(category, btn) {
      // 1. Highlight the correct button
      if(btn) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      }

      // 2. Filter the cards
      const cards = document.querySelectorAll('.provider-card');
      const searchVal = document.getElementById('searchInput').value.toLowerCase();

      cards.forEach(card => {
        const typeData = card.getAttribute('data-type');
        const searchData = card.getAttribute('data-search');

        let matchesCategory = false;
        
        if (category === 'all') matchesCategory = true;
        else if (category === 'hospice' && typeData.includes('hospice')) matchesCategory = true;
        else if (category === 'skilled' && (typeData.includes('skilled') || typeData.includes('nursing'))) matchesCategory = true;
        else if (category === 'board' && (typeData.includes('board') || typeData.includes('care') || typeData.includes('rcfe'))) matchesCategory = true;
        else if (category === 'palliative' && typeData.includes('palliative')) matchesCategory = true;
        else if (category === 'memory' && typeData.includes('memory')) matchesCategory = true;

        // Show if matches BOTH Category AND Search
        if (matchesCategory && searchData.includes(searchVal)) {
          card.style.display = 'flex';
        } else {
          card.style.display = 'none';
        }
      });
    }

    window.runSearch = function() {
      // Find which button is active so we don't break the category filter
      const activeBtn = document.querySelector('.filter-btn.active');
      let category = 'all';
      
      if(activeBtn) {
        const txt = activeBtn.innerText.toLowerCase();
        if(txt.includes('hospice')) category = 'hospice';
        else if(txt.includes('skilled')) category = 'skilled';
        else if(txt.includes('board')) category = 'board';
        else if(txt.includes('palliative')) category = 'palliative';
        else if(txt.includes('memory')) category = 'memory';
      }
      
      applyFilter(category, null);
    }
  </script>
</body>
</html>
