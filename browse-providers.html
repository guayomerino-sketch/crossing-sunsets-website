<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Browse Care Providers - Crossing Sunsets‚Ñ¢</title>

  <!-- Google Translate -->
  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        includedLanguages: 'en,es,zh-CN,fr,de,it,pt,ru,ja,ko,ar',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height:1.6; color:#333; background:#f5f7fa;
    }
    #google_translate_element {
      position: fixed; top:70px; right:10px; z-index:9999;
      background:#fff; padding:5px 10px; border-radius:8px;
      box-shadow:0 2px 10px rgba(0,0,0,.2);
    }

    nav {
      background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);
      padding:1rem 2rem; box-shadow:0 2px 10px rgba(0,0,0,.1);
      position:sticky; top:0; z-index:1000;
    }
    nav .container { max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; }
    .logo-section { display:flex; align-items:center; gap:15px; }
    .logo-section img { width:50px; height:50px; border-radius:10px; }
    .logo-section h1 { color:#fff; font-size:24px; }
    nav ul { list-style:none; display:flex; gap:2rem; }
    nav a { color:#fff; text-decoration:none; font-weight:500; transition:opacity .3s; }
    nav a:hover { opacity:.8; }

    .main-content { max-width:1200px; margin:40px auto; padding:0 20px; }
    .page-header { text-align:center; margin-bottom:40px; }
    .page-header h2 { color:#2c3e50; font-size:2.5rem; margin-bottom:10px; }
    .page-header p { color:#7f8c8d; font-size:1.1rem; }

    /* Banner visible siempre */
    .bed-stats-banner {
      display:grid; grid-template-columns:repeat(3,1fr);
      gap:20px; margin-bottom:30px; padding:20px; background:#fff;
      border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .stat-item { text-align:center; padding:15px; border-right:1px solid #E0E0E0; }
    .stat-item:last-child { border-right:none; }
    .stat-number { display:block; font-size:32px; font-weight:700; color:#00ACC1; margin-bottom:5px; }
    .stat-label { display:block; font-size:14px; color:#666; text-transform:uppercase; letter-spacing:.5px; }

    .filter-section { background:#fff; padding:25px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,.1); margin-bottom:20px; }
    .filter-label { color:#2c3e50; font-weight:600; margin-bottom:15px; display:block; font-size:1.1rem; }
    .filter-buttons { display:flex; gap:10px; flex-wrap:wrap; }
    .filter-btn {
      padding:10px 20px; border:2px solid #00bcd4; background:#fff; color:#00bcd4;
      border-radius:25px; cursor:pointer; font-weight:600; transition:all .3s; font-size:14px;
    }
    .filter-btn:hover { background:#e0f7fa; }
    .filter-btn.active { background:#00bcd4; color:#fff; }

    .search-box { background:#fff; padding:30px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,.1); margin-bottom:40px; }
    .search-box input {
      width:100%; padding:15px; border:2px solid #e0e0e0; border-radius:10px; font-size:16px; transition:border-color .3s;
    }
    .search-box input:focus { outline:none; border-color:#00bcd4; }

    .providers-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap:30px; }
    .provider-card { background:#fff; border-radius:15px; overflow:hidden; box-shadow:0 5px 20px rgba(0,0,0,.1); transition:transform .3s; }
    .provider-card:hover { transform:translateY(-10px); }
    .provider-header { background:linear-gradient(135deg, #00bcd4 0%, #0097a7 100%); padding:20px; text-align:center; }
    .provider-logo { width:80px; height:80px; border-radius:50%; background:#fff; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:2.5rem; }
    .provider-header h3 { color:#fff; font-size:1.5rem; margin-bottom:5px; }
    .provider-header .location { color:rgba(255,255,255,.9); font-size:.9rem; }
    .provider-body { padding:25px; }

    .provider-type-badge { display:inline-block; background:#e0f7fa; color:#00838f; padding:5px 15px; border-radius:15px; font-size:.85rem; font-weight:600; margin-bottom:15px; }
    .provider-description { color:#666; font-size:.95rem; line-height:1.6; margin-bottom:20px; min-height:60px; }

    .bed-availability { margin:15px 0; padding:12px 16px; background:#E8F5E9; border-radius:8px; display:flex; align-items:center; font-weight:600; color:#2E7D32; font-size:16px; }
    .bed-availability.low { background:#FFF3E0; color:#E65100; }
    .bed-icon { margin-right:10px; font-size:20px; }

    .provider-actions { display:flex; gap:10px; }
    .btn { flex:1; padding:12px; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:all .3s; text-align:center; text-decoration:none; display:inline-block; }
    .btn-reviews { background:#ff6b35; color:#fff; }
    .btn-reviews:hover { background:#e55a2b; transform:translateY(-2px); }
    .btn-review { background:transparent; color:#00bcd4; border:2px solid #00bcd4; }
    .btn-review:hover { background:#00bcd4; color:#fff; }

    .no-results { text-align:center; padding:60px 20px; background:#fff; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,.1); }
    .no-results p { color:#7f8c8d; font-size:1.2rem; }

    footer { background:#2c3e50; color:#fff; padding:40px 20px; text-align:center; margin-top:60px; }
    footer .footer-links { display:flex; justify-content:center; gap:2rem; margin-bottom:20px; flex-wrap:wrap; }
    footer a { color:#fff; text-decoration:none; transition:color .3s; }
    footer a:hover { color:#00bcd4; }
    footer .contact-info { margin-top:20px; font-size:.9rem; }
    footer .contact-info a { color:#00bcd4; }

    @media (max-width:768px) {
      nav ul { flex-direction:column; gap:1rem; }
      .providers-grid { grid-template-columns:1fr; }
      .page-header h2 { font-size:2rem; }
      .filter-buttons { justify-content:center; }
      .bed-stats-banner { grid-template-columns:1fr; }
      .stat-item { border-right:none; border-bottom:1px solid #E0E0E0; }
      .stat-item:last-child { border-bottom:none; }
    }
  </style>
</head>
<body>
  <div id="google_translate_element"></div>

  <nav>
    <div class="container">
      <div class="logo-section">
        <img src="crossing-sunsets-logo.png" alt="Crossing Sunsets Logo"/>
        <h1>Crossing Sunsets‚Ñ¢</h1>
      </div>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="browse-providers.html">Browse Providers</a></li>
        <li><a href="quick-signup.html">Leave a Review</a></li>
      </ul>
    </div>
  </nav>

  <div class="main-content">
    <div class="page-header">
      <h2>Browse Care Providers</h2>
      <p>Find compassionate hospice, palliative care, skilled nursing, boarding homes, and memory care in your area</p>
    </div>

    <!-- Always visible live stats -->
    <div id="bed-stats-banner" class="bed-stats-banner">
      <div class="stat-item">
        <span id="bedsAvailableTotal" class="stat-number">0</span>
        <span class="stat-label">Beds Available</span>
      </div>
      <div class="stat-item">
        <span id="facilitiesCount" class="stat-number">0</span>
        <span class="stat-label">Facilities</span>
      </div>
      <div class="stat-item">
        <span id="bedsTotal" class="stat-number">0</span>
        <span class="stat-label">Total Beds</span>
      </div>
    </div>

    <!-- Filters -->
    <div class="filter-section">
      <span class="filter-label">üè• Filter by Type of Care:</span>
      <div class="filter-buttons">
        <button class="filter-btn active" onclick="filterProviders('all', this)">All Providers</button>
        <button class="filter-btn" onclick="filterProviders('hospice', this)">‚òòÔ∏è Hospice</button>
        <button class="filter-btn" onclick="filterProviders('palliative', this)">üíô Palliative Care</button>
        <button class="filter-btn" onclick="filterProviders('skilled-nursing', this)">üè® Skilled Nursing</button>
        <button class="filter-btn" onclick="filterProviders('board-and-care-facilities', this)">üè° Board and Care Facilities</button>
        <button class="filter-btn" onclick="filterProviders('memory-care', this)">üß† Memory Care</button>
      </div>
    </div>

    <div class="search-box">
      <input type="text" id="searchInput" placeholder="üîç Search by city, state, or provider name..." onkeyup="searchProviders()"/>
    </div>

    <div class="providers-grid" id="providersGrid"></div>

    <div id="noResults" class="no-results" style="display:none;">
      <p>No providers found matching your search. Try a different search term or filter.</p>
    </div>
  </div>

  <footer>
    <div class="footer-links">
      <a href="index.html">Home</a>
      <a href="browse-providers.html">Browse Providers</a>
      <a href="choose-plan.html">üîí For Healthcare Providers</a>
      <a href="privacy.html">Privacy</a>
      <a href="mailto:support@crossingsunsets.app">üìß Contact Us</a>
    </div>
    <p>&copy; 2025 Crossing Sunsets‚Ñ¢. All rights reserved.</p>
    <div class="contact-info">
      üí¨ Support: <a href="mailto:support@crossingsunsets.app">support@crossingsunsets.app</a> |
      <a href="mailto:eduardo@crossingsunsets.app">eduardo@crossingsunsets.app</a>
    </div>
  </footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyB410YcmXKj09W82ck6tZ2WYhyLdyZWtEQ",
      authDomain: "crossing-sunsets.firebaseapp.com",
      databaseURL: "https://crossing-sunsets-default-rtdb.firebaseio.com",
      projectId: "crossing-sunsets",
      storageBucket: "crossing-sunsets.firebasestorage.app",
      messagingSenderId: "83761464492",
      appId: "1:83761464492:web:9e05d8af5a45fe1ff38b09",
      measurementId: "G-LG8VN0EZB7"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentFilter = 'all';
    const totalsByCategory = {
      all:{facilities:0,available:0,total:0},
      'skilled-nursing':{facilities:0,available:0,total:0},
      hospice:{facilities:0,available:0,total:0},
      palliative:{facilities:0,available:0,total:0},
      'board-and-care-facilities':{facilities:0,available:0,total:0},
      'memory-care':{facilities:0,available:0,total:0}
    };
    function resetTotals(){Object.keys(totalsByCategory).forEach(k=>totalsByCategory[k]={facilities:0,available:0,total:0});}
    function bumpTotals(cat,a,t){a=Number(a||0);t=Number(t||0);
      totalsByCategory[cat].facilities++;totalsByCategory.all.facilities++;
      if(Number.isFinite(a)){totalsByCategory[cat].available+=a;totalsByCategory.all.available+=a;}
      if(Number.isFinite(t)){totalsByCategory[cat].total+=t;totalsByCategory.all.total+=t;}
    }
    function updateBannerFor(cat){const t=totalsByCategory[cat]||totalsByCategory.all;
      document.getElementById('bedsAvailableTotal').textContent=t.available;
      document.getElementById('facilitiesCount').textContent=t.facilities;
      document.getElementById('bedsTotal').textContent=t.total;
    }

    function filterProviders(category, btnEl){
      currentFilter=category;
      document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
      if(btnEl)btnEl.classList.add('active');
      const cards=document.querySelectorAll('.provider-card');
      let visible=0;
      cards.forEach(c=>{
        const cat=c.getAttribute('data-category');
        if(category==='all'||cat===category){c.style.display='block';visible++;}
        else c.style.display='none';
      });
      document.getElementById('noResults').style.display=(visible===0)?'block':'none';
      updateBannerFor(currentFilter);
    }

    function searchProviders(){
      const term=(document.getElementById('searchInput').value||'').toLowerCase();
      const cards=document.querySelectorAll('.provider-card');
      let visible=0;
      cards.forEach(card=>{
        const name=(card.getAttribute('data-name')||'').toLowerCase();
        const loc=(card.getAttribute('data-location')||'').toLowerCase();
        const cat=card.getAttribute('data-category');
        const matchFilter=(currentFilter==='all'||cat===currentFilter);
        const matchSearch=(name.includes(term)||loc.includes(term));
        if(matchFilter&&matchSearch){card.style.display='block';visible++;}
        else card.style.display='none';
      });
      document.getElementById('noResults').style.display=(visible===0)?'block':'none';
    }

    function normalizeCategory(p){
      const raw=(p['service Type']||p.serviceType||p.careType||p.providerType||'').toLowerCase();
      if(raw.includes('skilled'))return'skilled-nursing';
      if(raw.includes('memory'))return'memory-care';
      if(raw.includes('board'))return'board-and-care-facilities';
      if(raw.includes('palliative'))return'palliative';
      return'hospice';
    }

    async function getBeds(id,p){
      try{
        const s=await db.collection('providers').doc(id).collection('beds').doc('current').get();
        if(s.exists){const b=s.data()||{};return{available:+(b.available||0),occupied:+(b.occupied||0),total:+(b.total||0)};}
      }catch(e){console.warn('beds/current read error',id,e);}
      return{available:+(p.available||0),occupied:+(p.occupied||0),total:+(p.total||0)};
    }

    // ‚òòÔ∏è Shamrock logic
