<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Browse Care Providers - Crossing Sunsets‚Ñ¢</title>
  <style>
    :root { --primary: #00bcd4; --dark: #023047; --bg: #f8fafc; --text: #334155; }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, system-ui, sans-serif; }
    body { background: var(--bg); color: var(--text); padding-bottom: 4rem; }

    /* --- Navigation --- */
    .nav { background: white; padding: 1rem 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 800; color: var(--primary); font-size: 1.5rem; text-decoration: none; }
    .nav-links a { text-decoration: none; color: var(--dark); font-weight: 600; margin-left: 1.5rem; transition: color 0.2s; }

    /* --- Grid & Cards (Restored to Original Design) --- */
    .container { max-width: 1200px; margin: 3rem auto; padding: 0 1.5rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }

    .card { background: white; border-radius: 16px; overflow: hidden; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: transform 0.2s; display: flex; flex-direction: column; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
    
    .card-header { background: var(--primary); padding: 2rem; text-align: center; color: white; }
    .avatar { width: 80px; height: 80px; background: white; border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--primary); }
    .card-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; }
    
    .card-body { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; gap: 1rem; }
    .tag { align-self: flex-start; background: #e0f2fe; color: #0284c7; padding: 4px 12px; border-radius: 99px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; }
    .description { font-size: 0.95rem; line-height: 1.6; color: #64748b; flex: 1; }
    
    .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem; }
    .btn { padding: 0.75rem; border-radius: 8px; font-weight: 600; text-align: center; text-decoration: none; transition: opacity 0.2s; font-size: 0.95rem; }
    .btn-primary { background: #ff5722; color: white; } 
    .btn-outline { border: 2px solid var(--primary); color: var(--primary); }
    .btn:hover { opacity: 0.9; }
  </style>
</head>
<body>

  <nav class="nav">
    <a href="index.html" class="brand">Crossing Sunsets‚Ñ¢</a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="browse-providers.html" style="color:var(--primary)">Browse Providers</a>
      <a href="lotus-review.html">Leave a Review</a>
    </div>
  </nav>

  <div class="container">
    <div class="grid" id="providersGrid">
      <p style="text-align:center; grid-column:1/-1; padding: 2rem; font-size: 1.2rem; color: #666;">Loading Providers...</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB410YcmXKj09W82ck6tZ2WYhyLdyZWtEQ",
      authDomain: "crossing-sunsets.firebaseapp.com",
      projectId: "crossing-sunsets",
      storageBucket: "crossing-sunsets.firebasestorage.app",
      messagingSenderId: "83761464492",
      appId: "1:83761464492:web:9e05d8af5a45fe1ff38b09"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadProviders() {
      const grid = document.getElementById('providersGrid');
      
      // 1. SAFE LOAD: We fetch ALL providers, then check status manually.
      // This prevents the "case sensitivity" bug (Approved vs approved)
      const q = query(collection(db, "providers"));
      
      try {
        const snapshot = await getDocs(q);
        grid.innerHTML = ""; 

        if (snapshot.empty) {
          grid.innerHTML = '<p style="text-align:center; grid-column:1/-1;">No providers found.</p>';
          return;
        }

        let count = 0;
        snapshot.forEach(doc => {
          const p = doc.data();
          const id = doc.id;
          
          // 2. SAFETY FILTER: Allow "Approved", "approved", "APPROVED"
          const status = (p.status || "").toLowerCase().trim();
          if (status !== 'approved') return;

          count++;

          // 3. Simple Icon Logic
          let icon = "üè•";
          const type = (p.facilityType || "").toLowerCase();
          if (type.includes("hospice")) icon = "‚òòÔ∏è";
          if (type.includes("nursing") || type.includes("skilled")) icon = "üè•";
          if (type.includes("board") || type.includes("care")) icon = "üè†";
          
          grid.innerHTML += `
            <div class="card">
              <div class="card-header">
                <div class="avatar">${icon}</div>
                <div class="card-title">${p.businessName || "Provider"}</div>
                <div style="font-size:0.9rem; opacity:0.9;">üìç ${p.city || "Location not specified"}</div>
              </div>
              <div class="card-body">
                <span class="tag">${p.facilityType || "Care Provider"}</span>
                <p class="description">${p.bio || "Dedicated to providing compassionate care."}</p>
                <div style="font-size:0.9rem; color:#475569;">üìß ${p.email}</div>
                
                <div class="actions">
                  <a href="profile.html?id=${id}" class="btn btn-primary">üìñ Read Reviews</a>
                  <a href="lotus-review.html?provider=${id}&name=${encodeURIComponent(p.businessName)}" class="btn btn-outline">‚úçÔ∏è Leave a Review</a>
                </div>
              </div>
            </div>
          `;
        });

        if (count === 0) {
          grid.innerHTML = '<p style="text-align:center; grid-column:1/-1;">No approved providers found.</p>';
        }

      } catch (error) {
        console.error(error);
        grid.innerHTML = `<p style="color:red; text-align:center;">Error loading providers. Please refresh.</p>`;
      }
    }

    loadProviders();
  </script>
</body>
</html>
