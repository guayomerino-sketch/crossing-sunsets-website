<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Provider Reviews - Crossing Sunsets‚Ñ¢</title>
<style>
  /* --- 1. Base Layout --- */
  body { 
    background-color: #f8fafc; 
    margin: 0; 
    padding: 20px; 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }
  
  .main-wrapper { max-width: 650px; margin: 0 auto; }
  h3 { color: #1e293b; text-align: center; margin-bottom: 5px; font-size: 1.6rem; }
  .subtitle { font-style: italic; color: #64748b; text-align: center; margin-bottom: 30px; font-size: 0.95rem; }

  /* --- 2. The "Safari Style" Review Card --- */
  #approved-reviews-display { margin-bottom: 40px; }
  
  .review-card {
    background: white;
    padding: 25px;
    border-radius: 20px;
    margin-bottom: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.03);
    border: 2px solid #e2e8f0;
    border-left: 6px solid #48bb78; /* That nice green you liked */
    transition: transform 0.2s ease;
  }
  
  .review-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
  .reviewer-name { font-weight: 700; color: #1e293b; font-size: 1.15rem; }
  .lotus-stars { color: #48bb78; font-size: 1.2rem; letter-spacing: 2px; }
  .review-text { color: #475569; line-height: 1.7; font-style: italic; font-size: 1.05rem; margin: 15px 0; }
  .review-footer { font-size: 0.85rem; color: #94a3b8; border-top: 1px solid #f1f5f9; padding-top: 12px; display: flex; align-items: center; gap: 5px; }

  /* --- 3. The Definition Legend --- */
  .lotus-container {
    background-color: #ffffff;
    padding: 30px;
    border-radius: 24px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }
  
  .legend-title { color: #334155; font-weight: 700; margin-bottom: 20px; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 0.5px; }

  .lotus-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    padding: 15px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    text-align: left;
  }
  
  .lotus-img { width: 45px; height: auto; margin-right: 15px; }
  .text-content h4 { margin: 0; color: #1e293b; font-size: 1rem; }
  .text-content p { margin: 3px 0 0; color: #64748b; font-size: 0.85rem; }
  .tag { float: right; color: #3b82f6; font-weight: bold; font-size: 0.8rem; }

  hr.divider { border: 0; height: 1px; background: #e2e8f0; margin: 40px auto; }
</style>
</head>
<body>

<div class="main-wrapper">
  <h3>Reviews Gallery</h3>
  <p class="subtitle">Verified feedback from our community.</p>

  <div id="approved-reviews-display">
    <p style="text-align:center; color:#94a3b8;">Connecting to secure database...</p>
  </div>

  <hr class="divider">

  <div class="lotus-container">
    <div class="legend-title">The Perfect 4-Lotus System‚Ñ¢</div>
    
    <div class="lotus-card">
      <img src="lotus-logo.png" class="lotus-img" alt="lotus">
      <div class="text-content">
        <h4>Compassionate <span class="tag">#1</span></h4>
        <p>Kind, caring, and empathetic staff.</p>
      </div>
    </div>

    <div class="lotus-card">
      <img src="lotus-logo.png" class="lotus-img" alt="lotus">
      <div class="text-content">
        <h4>Responsive <span class="tag">#2</span></h4>
        <p>Quick to respond to needs and concerns.</p>
      </div>
    </div>

    <div class="lotus-card">
      <img src="lotus-logo.png" class="lotus-img" alt="lotus">
      <div class="text-content">
        <h4>Supportive <span class="tag">#3</span></h4>
        <p>Helpful guidance for family and patient.</p>
      </div>
    </div>

    <div class="lotus-card">
      <img src="lotus-logo.png" class="lotus-img" alt="lotus">
      <div class="text-content">
        <h4>Professional <span class="tag">#4</span></h4>
        <p>Skilled, knowledgeable, and reliable.</p>
      </div>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB410YcmXKj09W82ck6tZ2WYhyLdyZWtEQ",
    authDomain: "crossing-sunsets.firebaseapp.com",
    projectId: "crossing-sunsets",
  };

  if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
  const db = firebase.firestore();

  const urlParams = new URLSearchParams(window.location.search);
  const pId = urlParams.get('providerId');
  const pName = urlParams.get('name');

  if (pName) {
    document.querySelector('h3').textContent = `Reviews for ${decodeURIComponent(pName)}`;
  }

  function loadApprovedReviews() {
    const container = document.getElementById('approved-reviews-display');
    if (!pId) {
      container.innerHTML = '<p style="text-align:center;">No provider selected.</p>';
      return;
    }

    db.collection('reviews')
      .where('provider_id', '==', pId)
      .where('approved', '==', true)
      .onSnapshot((snapshot) => {
        container.innerHTML = ''; 

        if (snapshot.empty) {
          container.innerHTML = '<p style="text-align:center; color:#64748b; margin-top:20px;">No approved reviews found yet for this provider.</p>';
          return;
        }

        snapshot.forEach((doc) => {
          const data = doc.data();
          const reviewDiv = document.createElement('div');
          reviewDiv.className = 'review-card';
          
          reviewDiv.innerHTML = `
            <div class="review-header">
              <span class="reviewer-name">${data.reviewer_name || 'Verified User'}</span>
              <span class="lotus-stars">${'‚òòÔ∏è'.repeat(data.lotus_rating || 0)}</span>
            </div>
            <p class="review-text">"${data.review_text}"</p>
            <div class="review-footer">
              <span>üìç ${data.location || 'Verified Location'}</span>
              <span style="margin-left:auto; color:#10b981; font-weight:600;">‚úì Verified Review</span>
            </div>
          `;
          container.appendChild(reviewDiv);
        });
      }, (error) => {
        container.innerHTML = '<p style="text-align:center; color:#ef4444;">Error loading reviews.</p>';
      });
  }

  loadApprovedReviews();
</script>
</body>
</html>
