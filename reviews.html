<!DOCTYPE html>
<html>
<head>
<style>
  /* --- 1. Layout & Text --- */
  body { background-color: #f4f7f6; margin: 0; padding: 20px; }
  
  #approved-reviews-display {
    max-width: 600px;
    margin: 20px auto;
  }

  .lotus-container {
    max-width: 600px;
    margin: 40px auto;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    text-align: center;
    background-color: #f9fbfd;
    padding: 30px;
    border-radius: 20px;
    border: 1px solid #e0e6ed;
  }
  
  h3 { color: #2c3e50; margin-bottom: 5px; text-align: center; font-family: sans-serif; }
  .subtitle { font-style: italic; color: #7f8c8d; margin-bottom: 25px; text-align: center; }

  /* --- 2. Review Card Styling --- */
  .review-card {
    background: white;
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    border-left: 5px solid #4caf50;
    font-family: sans-serif;
  }

  /* --- 3. Lotus Rating Legend Design --- */
  .lotus-card {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    text-align: left;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
  }
  
  .lotus-img {
    width: 50px;
    height: auto;
    margin-right: 20px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
  }

  .text-content h4 { margin: 0; color: #34495e; font-size: 1.1rem; }
  .text-content p { margin: 5px 0 0; color: #7f8c8d; font-size: 0.9rem; }
  .tag { float: right; color: #3498db; font-weight: bold; }

  hr.divider {
    border: 0;
    height: 1px;
    background: #d1d9e0;
    margin: 40px auto;
    max-width: 600px;
  }
</style>
</head>
<body>

  <h3>Reviews Gallery</h3>
  <p class="subtitle">Verified feedback from our community.</p>

  <div id="approved-reviews-display">
    <p style="text-align:center; color:#999;">Loading verified reviews...</p>
  </div>

  <hr class="divider">

  <div class="lotus-container">
    <h4 style="color:#2c3e50; margin-bottom:20px;">The Perfect 4-Lotus System‚Ñ¢</h4>
    
    <div class="lotus-card">
      <img src="lotus-logo.png" class="lotus-img" alt="lotus">
      <div class="text-content">
        <h4>Compassionate <span class="tag">#1</span></h4>
        <p>Kind, caring, and empathetic staff.</p>
      </div>
    </div>

    <div class="lotus-card">
      <img src="lotus-logo.png" class="lotus-img" alt="lotus">
      <div class="text-content">
        <h4>Responsive <span class="tag">#2</span></h4>
        <p>Quick to respond to needs and concerns.</p>
      </div>
    </div>

    <div class="lotus-card">
      <img src="lotus-logo.png" class="lotus-img" alt="lotus">
      <div class="text-content">
        <h4>Supportive <span class="tag">#3</span></h4>
        <p>Helpful guidance for family and patient.</p>
      </div>
    </div>

    <div class="lotus-card">
      <img src="lotus-logo.png" class="lotus-img" alt="lotus">
      <div class="text-content">
        <h4>Professional <span class="tag">#4</span></h4>
        <p>Skilled, knowledgeable, and reliable.</p>
      </div>
    </div>
  </div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB410YcmXKj09W82ck6tZ2WYhyLdyZWtEQ",
    authDomain: "crossing-sunsets.firebaseapp.com",
    projectId: "crossing-sunsets",
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const db = firebase.firestore();

  const urlParams = new URLSearchParams(window.location.search);
  const providerId = urlParams.get('providerId');
  const providerName = urlParams.get('name');

  if (providerName) {
    document.querySelector('h3').textContent = `Reviews for ${decodeURIComponent(providerName)}`;
  }

  function loadApprovedReviews() {
    const container = document.getElementById('approved-reviews-display');
    
    if (!providerId) {
      container.innerHTML = '<p style="text-align:center;">No provider selected.</p>';
      return;
    }

    db.collection('reviews')
      .where('provider_id', '==', providerId)
      .where('approved', '==', true)
      .onSnapshot((snapshot) => {
        container.innerHTML = ''; // Clear loading message

        if (snapshot.empty) {
          container.innerHTML = '<p style="text-align:center; color:#7f8c8d; margin-top:20px;">No approved reviews found yet.</p>';
          return;
        }

        snapshot.forEach((doc) => {
          const data = doc.data();
          const reviewDiv = document.createElement('div');
          reviewDiv.className = 'review-card';
          
          reviewDiv.innerHTML = `
            <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
              <strong style="font-size:1.1rem; color:#2c3e50;">${data.reviewer_name || 'Verified User'}</strong>
              <span style="font-size:1.2rem;">${'‚òòÔ∏è'.repeat(data.lotus_rating || 0)}</span>
            </div>
            <p style="font-style:italic; color:#4a5568; line-height:1.6; font-size:1rem;">"${data.review_text}"</p>
            <div style="font-size:0.85rem; color:#94a3b8; margin-top:15px; border-top:1px solid #f1f5f9; padding-top:10px;">
              üìç ${data.location || 'Verified Location'}
            </div>
          `;
          container.appendChild(reviewDiv);
        });
      }, (error) => {
        console.error("Error:", error);
        container.innerHTML = '<p style="text-align:center; color:red;">Error loading reviews.</p>';
      });
  }

  loadApprovedReviews();
</script>
</body>
</html>
